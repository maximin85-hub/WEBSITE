<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maximin</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header>
    <h1>maximin</h1>
  </header>

  <nav class="main-menu">
    <a class="menu-btn active" href="index.html">projets</a>
    <a class="menu-btn" href="a-propos.html">à propos</a>
    <a class="menu-btn" href="contact.html">contact</a>
  </nav>

  <main>
    <section id="projects">
      <!-- JS injecte les projets ici -->
    </section>
  </main>

  <script src="script.js"></script>

  <div id="cursor-text-circle">
  <div class="circle"></div>
</div>

<div id="project-modal" class="modal">
  <div id="project-modal-content" class="modal-content"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const text = ' maximin.gigaud@gmail.com';
  const radius = 50;
  const speed = 0.009;
  const trailSpacing = 1; // plus petit = traînée plus compacte
  const container = document.getElementById("cursor-text-circle");
  const circle = container.querySelector(".circle");

  const letters = [];
  const currentPositions = [];
  for (let i = 0; i < text.length; i++) {
    const span = document.createElement("span");
    span.textContent = text[i];
    circle.appendChild(span);
    letters.push(span);
    currentPositions.push({ x: window.innerWidth / 2, y: window.innerHeight / 2 });
  }

  let angleOffset = 0;
  let mouseX = window.innerWidth / 2;
  let mouseY = window.innerHeight / 2;
  let isMoving = false;
  let moveTimeout = null;

  // Pour la transition douce entre les modes
  let modeLerp = 0; // 0 = cercle, 1 = traînée

  // Historique des positions de la souris pour la traînée
  const mouseTrail = [{ x: mouseX, y: mouseY }];

  document.addEventListener("mousemove", (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
    isMoving = true;
    if (moveTimeout) clearTimeout(moveTimeout);
    moveTimeout = setTimeout(() => {
      isMoving = false;
    }, 300);
  });

  function lerp(a, b, t) {
    return a + (b - a) * t;
  }

  function lerp2D(posA, posB, t) {
    return {
      x: lerp(posA.x, posB.x, t),
      y: lerp(posA.y, posB.y, t)
    };
  }

  function animate() {
    angleOffset += speed;

    // Transition douce du mode
    if (isMoving) {
      modeLerp = lerp(modeLerp, 1, 0.18); // transition plus douce
    } else {
      modeLerp = lerp(modeLerp, 0, 0.10);
    }

    // Mise à jour du trail pour la traînée
    mouseTrail.unshift({ x: mouseX, y: mouseY });
    if (mouseTrail.length > letters.length * trailSpacing) {
      mouseTrail.length = letters.length * trailSpacing;
    }

    // Calcul des positions cibles pour chaque mode
    const circlePositions = [];
    const trailPositions = [];
    const centerX = 60;
    const centerY = 60;
    const step = (2 * Math.PI) / letters.length;
    for (let i = 0; i < letters.length; i++) {
      // Cercle (centré sur la souris)
      const angle = i * step + angleOffset;
      const x = Math.cos(angle) * radius + mouseX;
      const y = Math.sin(angle) * radius + mouseY;
      circlePositions[i] = { x, y };

      // Traînée : la première lettre colle au curseur, les suivantes suivent le trail
      if (i === 0) {
        trailPositions[i] = { x: mouseX, y: mouseY };
      } else {
        const trailIndex = Math.min(i * trailSpacing, mouseTrail.length - 1);
        trailPositions[i] = mouseTrail[trailIndex];
      }
    }

    // Interpolation douce vers la position cible mixée
    for (let i = 0; i < letters.length; i++) {
      const target = lerp2D(circlePositions[i], trailPositions[i], modeLerp);
      // La première lettre suit instantanément la souris en traînée
      const lerpAmount = (i === 0 && modeLerp > 0.8) ? 1 : 0.22;
      currentPositions[i] = lerp2D(currentPositions[i], target, lerpAmount);
      letters[i].style.left = `${currentPositions[i].x}px`;
      letters[i].style.top = `${currentPositions[i].y}px`;
    }

    // Le container prend toute la fenêtre pour que les lettres soient positionnées en absolu
    container.style.left = `0px`;
    container.style.top = `0px`;
    circle.style.width = `100vw`;
    circle.style.height = `100vh`;

    requestAnimationFrame(animate);
  }

  animate();
});
</script>

</body>
</html>
